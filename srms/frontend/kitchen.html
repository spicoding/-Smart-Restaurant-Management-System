<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kitchen Display System | DineEase</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --brand: #E85D46; --accent: #FE9C00; --bg: #2c3e50; --card: #34495e; --text: #ecf0f1; }
        
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid var(--brand); padding-bottom: 10px; }
        .brand { font-size: 1.8rem; font-weight: bold; color: var(--accent); }
        
        .ticket-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        .ticket { background: var(--card); border-radius: 8px; padding: 0; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border-top: 5px solid #e74c3c; animation: slideIn 0.3s; }
        .ticket.preparing { border-top-color: #f1c40f; }
        .ticket.ready { border-top-color: #2ecc71; opacity: 0.6; }

        .ticket-header { background: rgba(0,0,0,0.2); padding: 10px 15px; display: flex; justify-content: space-between; font-weight: bold; }
        .ticket-body { padding: 15px; }
        .item-row { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; }
        
        .btn { width: 100%; padding: 12px; border: none; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.2s; }
        .btn-start { background: #f1c40f; color: #333; }
        .btn-done { background: #2ecc71; color: white; }
        
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <div class="brand"><i class="fas fa-fire"></i> KITCHEN DISPLAY</div>
        <div id="clock" style="font-size: 1.2rem; font-weight: bold;"></div>
    </div>

    <div class="ticket-grid" id="kitchenGrid">
        <!-- Tickets go here -->
    </div>

    <script>
        // --- SHARED DATA LOGIC ---
        // In a real app, this connects to a DB. Here we simulate via LocalStorage.
        function loadData() {
            const data = localStorage.getItem('srms_data');
            return data ? JSON.parse(data) : { orders: [] };
        }
        
        function saveData(data) {
            localStorage.setItem('srms_data', JSON.stringify(data));
            // Trigger update in other tabs
            window.dispatchEvent(new Event('storage'));
        }

        function renderKitchen() {
            const data = loadData();
            const grid = document.getElementById('kitchenGrid');
            grid.innerHTML = '';

            // Filter for orders that have food items and aren't fully served
            const kitchenOrders = data.orders.filter(o => o.kitchenStatus !== 'served');

            if (kitchenOrders.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align:center; color:#7f8c8d;"><h3>No Active Orders</h3><p>Time to clean!</p></div>';
                return;
            }

            kitchenOrders.forEach(order => {
                const isPrep = order.kitchenStatus === 'preparing';
                const isReady = order.kitchenStatus === 'ready';
                
                let btnHtml = '';
                if(order.kitchenStatus === 'pending') {
                    btnHtml = `<button class="btn btn-start" onclick="updateStatus(${order.id}, 'preparing')">Start Cooking</button>`;
                } else if(isPrep) {
                    btnHtml = `<button class="btn btn-done" onclick="updateStatus(${order.id}, 'ready')">Mark Ready</button>`;
                } else {
                    btnHtml = `<div style="background:#27ae60; color:white; padding:10px; text-align:center">READY FOR PICKUP</div>`;
                }

                grid.innerHTML += `
                    <div class="ticket ${order.kitchenStatus}">
                        <div class="ticket-header">
                            <span>Table ${order.tableId}</span>
                            <span>#${order.id}</span>
                        </div>
                        <div class="ticket-body">
                            <div style="margin-bottom:10px; color:#bdc3c7; font-size:0.9rem">Waiter: ${order.waiter || 'Any'}</div>
                            ${parseItems(order.items, 'food')}
                        </div>
                        ${btnHtml}
                    </div>
                `;
            });
        }

        function parseItems(itemsString, type) {
            // Simple mock parser. In real app, items would be objects with categories.
            // For now, we assume all items in string are relevant or simply display all.
            return `<div class="item-row"><span>${itemsString}</span></div>`;
        }

        function updateStatus(orderId, status) {
            const data = loadData();
            const order = data.orders.find(o => o.id === orderId);
            if(order) {
                order.kitchenStatus = status;
                saveData(data);
                renderKitchen();
            }
        }

        // Live Clock
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);

        // Auto-Refresh when other tabs change data
        window.addEventListener('storage', renderKitchen);
        
        // Init
        renderKitchen();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bar Display | DineEase</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* Dark Theme but with Purple accents for Bar */
        :root { --brand: #E85D46; --accent: #FE9C00; --bg: #2d3436; --card: #353b48; --text: #dfe6e9; }
        
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid var(--brand); padding-bottom: 10px; }
        .brand { font-size: 1.8rem; font-weight: bold; color: var(--accent); }
        
        .ticket-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        .ticket { background: var(--card); border-radius: 8px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border-top: 5px solid #e74c3c; }
        .ticket.preparing { border-top-color: #f1c40f; }
        .ticket.ready { border-top-color: #00cec9; }

        .ticket-header { background: rgba(0,0,0,0.2); padding: 10px 15px; display: flex; justify-content: space-between; font-weight: bold; }
        .ticket-body { padding: 15px; }
        
        .btn { width: 100%; padding: 12px; border: none; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .btn-start { background: #f1c40f; color: #333; }
        .btn-done { background: #00cec9; color: white; }
    </style>
</head>
<body>

    <div class="header">
        <div class="brand"><i class="fas fa-cocktail"></i> BAR MONITOR</div>
        <div id="clock"></div>
    </div>

    <div class="ticket-grid" id="barGrid">
        <!-- JS Populated -->
    </div>

    <script>
        function loadData() { return JSON.parse(localStorage.getItem('srms_data') || '{"orders":[]}'); }
        function saveData(data) { localStorage.setItem('srms_data', JSON.stringify(data)); window.dispatchEvent(new Event('storage')); }

        function renderBar() {
            const data = loadData();
            const grid = document.getElementById('barGrid');
            grid.innerHTML = '';
            
            // Filter orders that need Bar service
            const barOrders = data.orders.filter(o => o.barStatus !== 'served' && o.barStatus !== 'none'); // Assuming 'none' if no drinks

            if (barOrders.length === 0) {
                grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; opacity:0.5"><h3>No Drinks Queued</h3></div>';
                return;
            }

            barOrders.forEach(order => {
                const isPrep = order.barStatus === 'preparing';
                
                let btnHtml = '';
                if(order.barStatus === 'pending') {
                    btnHtml = `<button class="btn btn-start" onclick="updateStatus(${order.id}, 'preparing')">Mix Drinks</button>`;
                } else if(isPrep) {
                    btnHtml = `<button class="btn btn-done" onclick="updateStatus(${order.id}, 'ready')">Drinks Up</button>`;
                } else {
                    btnHtml = `<div style="background:#00cec9; color:white; padding:10px; text-align:center">WAITING PICKUP</div>`;
                }

                grid.innerHTML += `
                    <div class="ticket ${order.barStatus}">
                        <div class="ticket-header">
                            <span>Table ${order.tableId}</span>
                            <span>#${order.id}</span>
                        </div>
                        <div class="ticket-body">
                            <div style="margin-bottom:10px; color:#b2bec3;">Waiter: ${order.waiter}</div>
                            <!-- In real app, we filter only Drink category items here -->
                            <div>${order.items}</div> 
                        </div>
                        ${btnHtml}
                    </div>
                `;
            });
        }

        function updateStatus(orderId, status) {
            const data = loadData();
            const order = data.orders.find(o => o.id === orderId);
            if(order) { order.barStatus = status; saveData(data); renderBar(); }
        }

        window.addEventListener('storage', renderBar);
        renderBar();
    </script>
</body>
</html>
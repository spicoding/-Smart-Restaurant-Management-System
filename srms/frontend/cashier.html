<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cashier | DineEase</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --brand: #E85D46; --bg: #f7f8f9; --text: #222; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; margin:0; }
        
        .list-col { width: 350px; background: white; border-right: 1px solid #ddd; padding: 20px; overflow-y: auto; }
        .main-col { flex: 1; padding: 40px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .order-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s; }
        .order-item:hover { background: #f0fdf4; }
        .order-item.active { background: #e0f2f1; border-left: 4px solid var(--brand); }
        
        .bill-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        
        .total-row { display: flex; justify-content: space-between; font-size: 1.5rem; font-weight: bold; margin: 20px 0; border-top: 2px dashed #ddd; padding-top: 20px; }
        
        input { width: 100%; padding: 15px; font-size: 1.2rem; margin-bottom: 20px; border: 2px solid #ddd; border-radius: 8px; }
        .btn-pay { width: 100%; padding: 15px; background: var(--brand); color: white; font-size: 1.2rem; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="list-col">
        <h3><i class="fas fa-cash-register"></i> Pending Payment</h3>
        <div id="paymentList">
            <!-- JS populated -->
        </div>
    </div>

    <div class="main-col">
        <div class="bill-card" id="billArea" style="display:none;">
            <h2 style="text-align:center; color:var(--brand)">Table <span id="billTable"></span></h2>
            <p style="text-align:center; color:#777">Order #<span id="billOrder"></span></p>
            
            <div id="billItems" style="margin: 20px 0;">
                <!-- Items list -->
            </div>

            <div class="total-row">
                <span>Total Due:</span>
                <span>KSH <span id="billTotal">0</span></span>
            </div>

            <label>Cash Received (KSH)</label>
            <input type="number" id="cashInput" oninput="calcChange()">
            
            <div style="margin-bottom:20px; font-weight:bold; color:#27ae60;">
                Change: KSH <span id="changeDisplay">0</span>
            </div>

            <button class="btn-pay" onclick="processPayment()">CONFIRM PAYMENT</button>
        </div>
        <div id="placeholder" style="color:#999;">Select an order to checkout</div>
    </div>

    <script>
        let currentOrder = null;

        function loadData() { return JSON.parse(localStorage.getItem('srms_data') || '{"orders":[]}'); }
        function saveData(data) { localStorage.setItem('srms_data', JSON.stringify(data)); window.dispatchEvent(new Event('storage')); }

        function renderCashier() {
            const data = loadData();
            const list = document.getElementById('paymentList');
            list.innerHTML = '';
            
            // Show orders that are "Active" but not "Completed" (Paid)
            // Assuming kitchen/bar served them, now they need to pay
            const payOrders = data.orders.filter(o => o.status !== 'completed' && o.status !== 'paid');

            payOrders.forEach(order => {
                const div = document.createElement('div');
                div.className = 'order-item';
                div.innerHTML = `<div><strong>Table ${order.tableId}</strong></div><div style="font-size:0.9rem; color:#666">Wait: ${order.waiter}</div>`;
                div.onclick = () => selectOrder(order);
                list.appendChild(div);
            });
        }

        function selectOrder(order) {
            currentOrder = order;
            document.getElementById('billArea').style.display = 'block';
            document.getElementById('placeholder').style.display = 'none';
            
            document.getElementById('billTable').innerText = order.tableId;
            document.getElementById('billOrder').innerText = order.id;
            
            // Simulating price since mock data didn't have itemized prices
            // In real app, calculate from items array
            const mockTotal = 2500; 
            document.getElementById('billTotal').innerText = mockTotal;
            document.getElementById('billItems').innerHTML = `<p>${order.items}</p>`;
        }

        function calcChange() {
            const total = parseInt(document.getElementById('billTotal').innerText);
            const given = parseInt(document.getElementById('cashInput').value) || 0;
            document.getElementById('changeDisplay').innerText = Math.max(0, given - total);
        }

        function processPayment() {
            if(!currentOrder) return;
            const data = loadData();
            const order = data.orders.find(o => o.id === currentOrder.id);
            if(order) {
                order.status = 'completed'; // Or 'paid'
                // Free up table logic would go here or be handled by Admin
                saveData(data);
                alert("Payment Successful! Receipt Printed.");
                document.getElementById('billArea').style.display = 'none';
                document.getElementById('placeholder').style.display = 'block';
                renderCashier();
            }
        }

        window.addEventListener('storage', renderCashier);
        renderCashier();
    </script>
</body>
</html>